<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Connection Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            margin-left: 10px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.pending {
            background: #fff3cd;
            color: #856404;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #2563eb;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 13px;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>
            Supabase Connection Test
            <span id="overallStatus" class="status pending">Testing...</span>
        </h1>
        <p>Testing connection to Supabase for KFA Project</p>
    </div>

    <div class="card">
        <h2>1. Configuration</h2>
        <div id="configTest" class="test-result">
            <button onclick="testConfig()">Test Configuration</button>
            <div id="configResult"></div>
        </div>
    </div>

    <div class="card">
        <h2>2. Storage Connection</h2>
        <div id="storageTest" class="test-result">
            <button onclick="testStorage()">Test Storage</button>
            <div id="storageResult"></div>
        </div>
    </div>

    <div class="card">
        <h2>3. Database Connection</h2>
        <div id="dbTest" class="test-result">
            <button onclick="testDatabase()">Test Database</button>
            <div id="dbResult"></div>
        </div>
    </div>

    <div class="card">
        <h2>4. Authentication</h2>
        <div id="authTest" class="test-result">
            <button onclick="testAuth()">Test Auth</button>
            <div id="authResult"></div>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

        // Configuration
        const SUPABASE_URL = 'https://eofneihisbhucxcydvac.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVvZm5laWhpc2JodWN4Y3lkdmFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NzI5NjksImV4cCI6MjA3ODQ0ODk2OX0.9jHkxmjfWQRu6DbFOiqaYH9URxKGHiH7q64HVMYt1eo'

        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

        // Make functions available globally
        window.supabase = supabase

        window.testConfig = async function() {
            const result = document.getElementById('configResult')
            result.innerHTML = '<p>Testing configuration...</p>'

            try {
                const tests = {
                    'Supabase URL': SUPABASE_URL ? '✅ Set' : '❌ Missing',
                    'Anon Key': SUPABASE_ANON_KEY ? '✅ Set' : '❌ Missing',
                    'Client Created': supabase ? '✅ Yes' : '❌ No',
                }

                let html = '<h3>Configuration:</h3><pre>'
                for (const [key, value] of Object.entries(tests)) {
                    html += `${key}: ${value}\n`
                }
                html += '</pre>'

                result.innerHTML = html
            } catch (error) {
                result.innerHTML = `<p style="color: red;">❌ Error: ${error.message}</p>`
            }
        }

        window.testStorage = async function() {
            const result = document.getElementById('storageResult')
            result.innerHTML = '<p>Testing storage...</p>'

            try {
                // List buckets
                const { data: buckets, error } = await supabase.storage.listBuckets()

                if (error) throw error

                let html = '<h3>✅ Storage Connected</h3>'
                html += '<p><strong>Available Buckets:</strong></p><ul>'

                if (buckets && buckets.length > 0) {
                    buckets.forEach(bucket => {
                        html += `<li>${bucket.name} (${bucket.public ? 'Public' : 'Private'})</li>`
                    })
                } else {
                    html += '<li>No buckets found</li>'
                }

                html += '</ul>'
                result.innerHTML = html
            } catch (error) {
                result.innerHTML = `<p style="color: red;">❌ Error: ${error.message}</p>`
            }
        }

        window.testDatabase = async function() {
            const result = document.getElementById('dbResult')
            result.innerHTML = '<p>Testing database...</p>'

            try {
                // Try to query a table (users table should exist)
                const { data, error } = await supabase
                    .from('users')
                    .select('count')
                    .limit(1)

                if (error) {
                    // Table might not exist, which is okay for testing
                    result.innerHTML = `<h3>⚠️ Database Connected (no tables yet)</h3><p>Error: ${error.message}</p><p>This is normal if migrations haven't run yet.</p>`
                } else {
                    result.innerHTML = '<h3>✅ Database Connected</h3><p>Successfully queried database</p>'
                }
            } catch (error) {
                result.innerHTML = `<p style="color: red;">❌ Error: ${error.message}</p>`
            }
        }

        window.testAuth = async function() {
            const result = document.getElementById('authResult')
            result.innerHTML = '<p>Testing auth...</p>'

            try {
                // Get current session
                const { data: { session }, error } = await supabase.auth.getSession()

                if (error) throw error

                let html = '<h3>✅ Auth System Available</h3>'

                if (session) {
                    html += '<p>✅ User is logged in</p>'
                    html += `<pre>${JSON.stringify(session.user, null, 2)}</pre>`
                } else {
                    html += '<p>ℹ️ No active session (not logged in)</p>'
                    html += '<p>This is normal for testing. Auth system is working.</p>'
                }

                result.innerHTML = html
            } catch (error) {
                result.innerHTML = `<p style="color: red;">❌ Error: ${error.message}</p>`
            }
        }

        // Auto-test configuration on load
        window.addEventListener('load', () => {
            testConfig()
            document.getElementById('overallStatus').textContent = 'Ready'
            document.getElementById('overallStatus').className = 'status success'
        })
    </script>
</body>
</html>
