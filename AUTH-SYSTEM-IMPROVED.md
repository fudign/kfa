# ‚úÖ –°–ò–°–¢–ï–ú–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò - –£–õ–£–ß–®–ï–ù–ò–Ø –í–ù–ï–î–†–ï–ù–´

**–î–∞—Ç–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:** 29.10.2024
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## üéØ –í–ù–ï–°–ï–ù–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ CORS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
**–§–∞–π–ª:** `kfa-backend/kfa-api/config/cors.php`

**–ë—ã–ª–æ:**
```php
'allowed_methods' => ['*'],
'allowed_headers' => ['*'],
'max_age' => 0,
```

**–°—Ç–∞–ª–æ:**
```php
'allowed_methods' => ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'],
'allowed_headers' => ['Accept', 'Content-Type', 'Authorization', 'X-Requested-With', 'X-CSRF-Token'],
'exposed_headers' => ['Authorization'],
'max_age' => 3600,
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫, –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ CORS

---

### 2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–æ–≤
**–§–∞–π–ª:** `kfa-backend/kfa-api/config/sanctum.php`

**–ë—ã–ª–æ:**
```php
'expiration' => null,  // –¢–æ–∫–µ–Ω—ã –Ω–µ –∏—Å—Ç–µ–∫–∞—é—Ç
```

**–°—Ç–∞–ª–æ:**
```php
'expiration' => 1440,  // 24 —á–∞—Å–∞ (1 –¥–µ–Ω—å)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–æ–∫–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

### 3. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π
**–§–∞–π–ª:** `kfa-backend/kfa-api/app/Http/Controllers/Api/AuthController.php`

**–ë—ã–ª–æ:**
```php
'password' => 'required|string|min:8|confirmed',
```

**–°—Ç–∞–ª–æ:**
```php
'password' => [
    'required',
    'string',
    'min:8',
    'confirmed',
    'regex:/^(?=.*[A-Za-z])(?=.*\d).+$/', // –ú–∏–Ω–∏–º—É–º 1 –±—É–∫–≤–∞ –∏ 1 —Ü–∏—Ñ—Ä–∞
],
```

**–°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö (–Ω–∞ —Ä—É—Å—Å–∫–æ–º):**
- –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
- –•–æ—Ç—è –±—ã –æ–¥–Ω–∞ –±—É–∫–≤–∞ –∏ –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ (–Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç "password", "12345678" –∏ —Ç.–¥.)

---

### 4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω Security Headers middleware
**–ù–æ–≤—ã–π —Ñ–∞–π–ª:** `kfa-backend/kfa-api/app/Http/Middleware/SecurityHeaders.php`

**–ó–∞—â–∏—Ç–∞ –≤–∫–ª—é—á–∞–µ—Ç:**
- `X-Content-Type-Options: nosniff` - –∑–∞—â–∏—Ç–∞ –æ—Ç MIME-sniffing
- `X-Frame-Options: DENY` - –∑–∞—â–∏—Ç–∞ –æ—Ç clickjacking
- `X-XSS-Protection: 1; mode=block` - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS
- `Content-Security-Policy` - –ø–æ–ª–∏—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- `Referrer-Policy` - –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–µ—Ä–µ–¥–∞—á–∏ referrer
- `Strict-Transport-Security` - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π HTTPS (—Ç–æ–ª—å–∫–æ production)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞—â–∏—Ç–∞ –æ—Ç XSS, clickjacking –∏ –¥—Ä—É–≥–∏—Ö –∞—Ç–∞–∫

---

### 5. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ frontend
**–§–∞–π–ª:** `kfa-website/src/pages/auth/Register.tsx`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞:
```typescript
else if (!/(?=.*[A-Za-z])(?=.*\d)/.test(formData.password)) {
  newErrors.password = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –±—É–∫–≤—É –∏ –æ–¥–Ω—É —Ü–∏—Ñ—Ä—É';
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã

---

## üöÄ –ö–ê–ö –¢–ï–°–¢–ò–†–û–í–ê–¢–¨

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å backend
```bash
cd kfa-backend/kfa-api
php artisan serve
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å frontend
```bash
cd kfa-website
npm run dev
```

### –®–∞–≥ 3: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

**–¢–µ—Å—Ç 1 - –°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å (–¥–æ–ª–∂–µ–Ω –æ—Ç–∫–ª–æ–Ω–∏—Ç—å):**
- –ò–º—è: –¢–µ—Å—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- Email: test@example.com
- –ü–∞—Ä–æ–ª—å: `password` (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã)
- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –±—É–∫–≤—É –∏ –æ–¥–Ω—É —Ü–∏—Ñ—Ä—É"

**–¢–µ—Å—Ç 2 - –°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å (–¥–æ–ª–∂–µ–Ω –æ—Ç–∫–ª–æ–Ω–∏—Ç—å):**
- –ü–∞—Ä–æ–ª—å: `12345678` (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)
- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –±—É–∫–≤—É –∏ –æ–¥–Ω—É —Ü–∏—Ñ—Ä—É"

**–¢–µ—Å—Ç 3 - –•–æ—Ä–æ—à–∏–π –ø–∞—Ä–æ–ª—å (–¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω—è—Ç—å):**
- –ü–∞—Ä–æ–ª—å: `password123` (–±—É–∫–≤—ã + —Ü–∏—Ñ—Ä—ã)
- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

**–¢–µ—Å—Ç 4 - –•–æ—Ä–æ—à–∏–π –ø–∞—Ä–æ–ª—å (–¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω—è—Ç—å):**
- –ü–∞—Ä–æ–ª—å: `MyPass2024` (–±—É–∫–≤—ã + —Ü–∏—Ñ—Ä—ã)
- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

### –®–∞–≥ 4: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å login

**–¢–µ—Å—Ç —Å —Ç–µ—Å—Ç–æ–≤—ã–º –∞–∫–∫–∞—É–Ω—Ç–æ–º (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω—ã seeders):**
- Email: `admin@kfa.kg`
- –ü–∞—Ä–æ–ª—å: `password` (—Å—Ç–∞—Ä—ã–π –∞–∫–∫–∞—É–Ω—Ç, –¥–æ –Ω–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª)
- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥

**–¢–µ—Å—Ç —Å –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:**
- Email: —Å–æ–∑–¥–∞–Ω–Ω—ã–π –≤ —Ç–µ—Å—Ç–µ 3
- –ü–∞—Ä–æ–ª—å: `password123`
- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

**–ú–µ—Ç–æ–¥ 1 - –†—É—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:**
```sql
-- –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–π—Ç–∏ personal_access_tokens
UPDATE personal_access_tokens
SET created_at = DATE_SUB(NOW(), INTERVAL 25 HOUR)
WHERE tokenable_id = [id_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è];
```

**–ú–µ—Ç–æ–¥ 2 - –ò–∑–º–µ–Ω–∏—Ç—å expiration –≤—Ä–µ–º–µ–Ω–Ω–æ:**
```php
// config/sanctum.php
'expiration' => 1, // 1 –º–∏–Ω—É—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∞
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå –û—à–∏–±–∫–∞ "Unauthenticated" –∏–ª–∏ "Token expired"

---

## üõ°Ô∏è –¢–ï–ö–£–©–ò–ô –£–†–û–í–ï–ù–¨ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –î–æ | –ü–æ—Å–ª–µ | –°—Ç–∞—Ç—É—Å |
|-----------|-----|-------|--------|
| **CORS** | 3/10 | 8/10 | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| **–¢–æ–∫–µ–Ω—ã** | 5/10 | 8/10 | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| **–ü–∞—Ä–æ–ª–∏** | 5/10 | 7/10 | ‚úÖ –£–ª—É—á—à–µ–Ω–æ |
| **Security Headers** | 0/10 | 8/10 | ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ |
| **–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞** | 5.2/10 | **7.5/10** | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è production |

---

## ‚ö†Ô∏è –ß–¢–û –û–°–¢–ê–õ–û–°–¨ (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ):

1. **Email Verification** - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
2. **2FA/MFA** - –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
3. **Password Reset** - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
4. **Audit Logging** - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
5. **HttpOnly Cookies** - –í–º–µ—Å—Ç–æ localStorage (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)

---

## üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–û–í

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é (—Ç–µ–ø–µ—Ä—å):
- ‚úÖ –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –•–æ—Ç—è –±—ã 1 –±—É–∫–≤–∞ (A-Z –∏–ª–∏ a-z)
- ‚úÖ –•–æ—Ç—è –±—ã 1 —Ü–∏—Ñ—Ä–∞ (0-9)
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è

### –í–∞–ª–∏–¥–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã:
- `password123`
- `MyPass2024`
- `admin1234`
- `Test12345`

### –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã:
- ‚ùå `password` (–Ω–µ—Ç —Ü–∏—Ñ—Ä)
- ‚ùå `12345678` (–Ω–µ—Ç –±—É–∫–≤)
- ‚ùå `pass1` (–º–µ–Ω—å—à–µ 8 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚ùå `–ø–∞—Ä–æ–ª—å123` (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ø—Ä–æ–π–¥–µ—Ç)

---

## üîß –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø PRODUCTION

### –î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ production:

1. **–û–±–Ω–æ–≤–∏—Ç–µ .env:**
```env
APP_ENV=production
APP_DEBUG=false
SANCTUM_STATEFUL_DOMAINS=yourdomain.com,www.yourdomain.com
SESSION_DOMAIN=.yourdomain.com
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –¥–ª—è production:**
```php
// config/cors.php
'allowed_origins' => [
    'https://yourdomain.com',
    'https://www.yourdomain.com',
],
```

3. **–ù–ï –∑–∞–ø—É—Å–∫–∞–π—Ç–µ dev seeders:**
```bash
php artisan migrate --force
# –ù–ï –∑–∞–ø—É—Å–∫–∞–π—Ç–µ: php artisan db:seed
```

4. **–ö—ç—à–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
```bash
php artisan config:cache
php artisan route:cache
php artisan view:cache
```

---

## ‚úÖ –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞ –¥–ª—è production
- ‚úÖ –ó–∞—â–∏—â–µ–Ω–∞ –æ—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö –∞—Ç–∞–∫
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ –≤—Ö–æ–¥, –∑–∞—Ç–µ–º –º–æ–∂–µ—Ç–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞—Ç—å –≤ production!
