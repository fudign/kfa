# üñºÔ∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ó–∞–≥—Ä—É–∑–∫–∏ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π - –†–µ—à–µ–Ω–∏–µ

**–î–∞—Ç–∞**: 2025-11-13
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤ –Ω–æ–≤–æ—Å—Ç–∏
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ Permissions

**–ü—Ä–æ–±–ª–µ–º–∞**: API —Ç—Ä–µ–±—É–µ—Ç permissions, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –±–∞–∑—É:

```
media.view   - –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤  ‚ùå (–æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª)
media.upload - –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤        ‚ùå (–æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª)
media.delete - –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤        ‚ùå (–æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª)
```

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω seeder `AddMediaPermissionsSeeder.php`

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã permissions –≤ –±–∞–∑—É
- ‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω—ã —Ä–æ–ª–∏ admin
- ‚úÖ Seeder —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω

### 2. ‚ùå –ñ–µ—Å—Ç–∫–æ –ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –î–∏—Å–∫ –≤ MediaService

**–ü—Ä–æ–±–ª–µ–º–∞**:

```php
// MediaService.php - —Å—Ç–∞—Ä—ã–π –∫–æ–¥
$fullPath = $file->storeAs($path, $filename, 'public');  // ‚ùå –í—Å–µ–≥–¥–∞ 'public'
'disk' => 'public',  // ‚ùå –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç .env
```

–ù–æ –≤ `.env`:

```
FILESYSTEM_DISK=supabase  # ‚ùå –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–æ—Å—å
```

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω MediaService

```php
// –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥ –∏–∑ .env
$disk = config('filesystems.default');  // ‚úÖ 'supabase' –∏–∑ .env
$fullPath = $file->storeAs($path, $filename, $disk);  // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–∏—Å–∫
```

### 3. ‚ùå –°—Ç–∞—Ä—ã–π JWT –¢–æ–∫–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–æ–≤—ã–µ permissions

**–†–µ—à–µ–Ω–∏–µ**: –ù—É–∂–Ω–æ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è!

---

## ‚úÖ –ß—Ç–æ –ë—ã–ª–æ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. MediaService.php

- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `config('filesystems.default')` –≤–º–µ—Å—Ç–æ –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ 'public'
- ‚úÖ –†–∞–∑–Ω—ã–µ –ø—É—Ç–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–∏—Å–∫–æ–≤:
  - **Supabase**: `2025/01/13/file.jpg` (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ 'media/', —Ç.–∫. bucket —É–∂–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è 'media')
  - **Local/Public**: `media/2025/01/13/file.jpg` (—Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º 'media/')
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π disk –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### 2. Permissions

- ‚úÖ `media.view` - –¥–æ–±–∞–≤–ª–µ–Ω –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω admin
- ‚úÖ `media.upload` - –¥–æ–±–∞–≤–ª–µ–Ω –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω admin
- ‚úÖ `media.delete` - –¥–æ–±–∞–≤–ª–µ–Ω –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω admin

### 3. API Routes

```php
// routes/api.php
Route::middleware(['auth:sanctum', 'permission:media.view'])->group(function () {
    Route::get('/media', [MediaController::class, 'index']);        // ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
    Route::get('/media/{media}', [MediaController::class, 'show']);  // ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
});

Route::middleware(['auth:sanctum', 'permission:media.upload'])->group(function () {
    Route::post('/media', [MediaController::class, 'store']);  // ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
});
```

---

## üöÄ –ö–∞–∫ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å JWT –¢–æ–∫–µ–Ω (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

**–û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É:**

```
http://localhost:3000/auth/force-logout
```

–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. –û—á–∏—Å—Ç–∏—Ç —Å—Ç–∞—Ä—ã–π —Ç–æ–∫–µ–Ω
2. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
3. –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω —Å `media.upload` permission

### –®–∞–≥ 2: –í–æ–π—Ç–∏ –≤ –°–∏—Å—Ç–µ–º—É

```
Email: admin@kfa.kg
Password: (–∏–∑ .env —Ñ–∞–π–ª–∞ backend)
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å –ù–æ–≤–æ—Å—Ç—å —Å –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º

1. –û—Ç–∫—Ä–æ–π—Ç–µ `/dashboard/news`
2. –ù–∞–∂–º–∏—Ç–µ **"–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å"**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫: "–¢–µ—Å—Ç–æ–≤–∞—è –Ω–æ–≤–æ—Å—Ç—å"
   - –ö–æ–Ω—Ç–µ–Ω—Ç: "–≠—Ç–æ —Ç–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
4. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**

   **–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ MediaPicker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
   - –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"–í—ã–±—Ä–∞—Ç—å"** —Ä—è–¥–æ–º —Å –ø–æ–ª–µ–º "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
   - –û—Ç–∫—Ä–æ–µ—Ç—Å—è MediaPicker
   - –ù–∞–∂–º–∏—Ç–µ **"–ó–∞–≥—Ä—É–∑–∏—Ç—å"**
   - –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª (JPG, PNG, WebP, GIF –¥–æ 5MB)
   - –§–∞–π–ª –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –≤ Supabase Storage
   - –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
   - –ù–∞–∂–º–∏—Ç–µ **"–í—ã–±—Ä–∞—Ç—å (1)"**
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –≤ –ø—Ä–µ–≤—å—é! ‚úÖ

   **–í–∞—Ä–∏–∞–Ω—Ç B: –í—Å—Ç–∞–≤–∏—Ç—å URL –≤—Ä—É—á–Ω—É—é**
   - –í—Å—Ç–∞–≤—å—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø–æ–ª–µ
   - –ù–∞–ø—Ä–∏–º–µ—Ä: `https://example.com/image.jpg`
   - –ü—Ä–µ–≤—å—é –ø–æ—è–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

5. –ù–∞–∂–º–∏—Ç–µ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"**

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –†–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Permissions

```bash
cd kfa-backend/kfa-api
php artisan tinker
```

```php
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ permissions —Å—É—â–µ—Å—Ç–≤—É—é—Ç
DB::table('permissions')->whereIn('name', [
    'media.view', 'media.upload', 'media.delete'
])->get(['name']);

// –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å 3 –∑–∞–ø–∏—Å–∏

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ admin –∏–º–µ–µ—Ç —ç—Ç–∏ –ø—Ä–∞–≤–∞
$admin = DB::table('roles')->where('name', 'admin')->first();
$count = DB::table('role_has_permissions')
    ->where('role_id', $admin->id)
    ->count();
// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 20+
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –ù–∞–ø—Ä—è–º—É—é

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–µ–¥–∏–∞ (—Ç—Ä–µ–±—É–µ—Ç auth + media.view)
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://127.0.0.1:8000/api/media

# –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª (—Ç—Ä–µ–±—É–µ—Ç auth + media.upload)
curl -X POST \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@image.jpg" \
  -F "collection=news" \
  http://127.0.0.1:8000/api/media
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase Storage

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Storage** ‚Üí **media** bucket
3. –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ API, –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
   ```
   media/
     2025/
       01/
         13/
           [random-hash].jpg  ‚úÖ
   ```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –•—Ä–∞–Ω–µ–Ω–∏—è

### Supabase Storage (–ü—Ä–æ–¥–∞–∫—à–Ω)

```
Bucket: media
‚îî‚îÄ‚îÄ 2025/
    ‚îî‚îÄ‚îÄ 01/
        ‚îî‚îÄ‚îÄ 13/
            ‚îú‚îÄ‚îÄ abc123...xyz.jpg  ‚Üê –û—Ä–∏–≥–∏–Ω–∞–ª
            ‚îú‚îÄ‚îÄ def456...uvw.png  ‚Üê –û—Ä–∏–≥–∏–Ω–∞–ª
            ‚îî‚îÄ‚îÄ ...
```

**URL —Ñ–æ—Ä–º–∞—Ç:**

```
https://eofneihisbhucxcydvac.supabase.co/storage/v1/object/public/media/2025/01/13/abc123.jpg
```

### Local Storage (–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

```
storage/app/public/
‚îî‚îÄ‚îÄ media/
    ‚îî‚îÄ‚îÄ 2025/
        ‚îî‚îÄ‚îÄ 01/
            ‚îî‚îÄ‚îÄ 13/
                ‚îú‚îÄ‚îÄ abc123...xyz.jpg
                ‚îî‚îÄ‚îÄ ...
```

**URL —Ñ–æ—Ä–º–∞—Ç:**

```
http://localhost:8000/storage/media/2025/01/13/abc123.jpg
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Backend (.env)

```env
# Supabase Storage (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ –∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
FILESYSTEM_DISK=supabase
SUPABASE_URL=https://eofneihisbhucxcydvac.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_STORAGE_BUCKET=media
```

**–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–µ–∑ Supabase:**

```env
# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ local storage
FILESYSTEM_DISK=public

# –ò –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
# php artisan storage:link
```

### Frontend (services/api.ts)

```typescript
// Media API - —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω! ‚úÖ
export const mediaAPI = {
  getAll: async (params) => {
    const response = await api.get('/media', { params });
    return response.data;
  },

  upload: async (file: File, collection?: string) => {
    const formData = new FormData();
    formData.append('file', file);
    if (collection) {
      formData.append('collection', collection);
    }

    const response = await api.post('/media', formData, {
      headers: {
        'Content-Type': 'multipart/form-data',
      },
    });
    return response.data;
  },
};
```

---

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏"

**–ü—Ä–∏—á–∏–Ω–∞**: –°—Ç–∞—Ä—ã–π JWT —Ç–æ–∫–µ–Ω
**–†–µ—à–µ–Ω–∏–µ**:

```
http://localhost:3000/auth/force-logout
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤"

**–ü—Ä–∏—á–∏–Ω–∞ 1**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Supabase credentials
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env`:

```bash
cd kfa-backend/kfa-api
cat .env | grep SUPABASE
```

**–ü—Ä–∏—á–∏–Ω–∞ 2**: CORS –æ—à–∏–±–∫–∞ –≤ Supabase
**–†–µ—à–µ–Ω–∏–µ**:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
2. Storage ‚Üí Configuration ‚Üí CORS
3. –î–æ–±–∞–≤—å—Ç–µ:
   ```
   http://localhost:3000
   http://localhost:8000
   https://your-production-domain.com
   ```

**–ü—Ä–∏—á–∏–Ω–∞ 3**: Bucket –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
**–†–µ—à–µ–Ω–∏–µ**:

1. Supabase Dashboard ‚Üí Storage
2. Create bucket: `media`
3. Public: ‚úÖ Yes
4. File size limit: 5MB

### –ü—Ä–æ–±–ª–µ–º–∞: –§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: URL –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Media model accessor:

```php
// app/Models/Media.php
public function getUrlAttribute(): string
{
    return Storage::disk($this->disk)->url($this->path);  // ‚úÖ
}
```

### –ü—Ä–æ–±–ª–µ–º–∞: Backend –æ—à–∏–±–∫–∞ "Class 'Storage' not found"

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Supabase Flysystem adapter
**–†–µ—à–µ–Ω–∏–µ**:

```bash
cd kfa-backend/kfa-api
composer require quix-labs/laravel-supabase-flysystem
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –ü–æ—Å–ª–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### ‚úÖ –ß—Ç–æ –î–æ–ª–∂–Ω–æ –†–∞–±–æ—Ç–∞—Ç—å:

1. ‚úÖ **MediaPicker –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è**
   - –ö–Ω–æ–ø–∫–∞ "–í—ã–±—Ä–∞—Ç—å" —Ä—è–¥–æ–º —Å –ø–æ–ª–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –≥–∞–ª–µ—Ä–µ–µ–π

2. ‚úÖ **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤**
   - Drag & Drop —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –ö–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å" —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –§–∞–π–ª—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ Supabase Storage

3. ‚úÖ **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
   - –ü—Ä–µ–≤—å—é –≤ MediaPicker
   - –ü—Ä–µ–≤—å—é –≤ —Ñ–æ—Ä–º–µ –Ω–æ–≤–æ—Å—Ç–∏
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ –Ω–æ–≤–æ—Å—Ç–µ–π
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –ø—É–±–ª–∏—á–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –Ω–æ–≤–æ—Å—Ç–∏

4. ‚úÖ **API –¥–æ—Å—Ç—É–ø–µ–Ω**
   - `GET /api/media` - —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
   - `POST /api/media` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
   - `DELETE /api/media/{id}` - —É–¥–∞–ª–µ–Ω–∏–µ

---

## üéØ –ò—Ç–æ–≥

### –ß—Ç–æ –ë—ã–ª–æ –°–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ permissions (`media.view`, `media.upload`, `media.delete`)
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω MediaService –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ–≥–æ –¥–∏—Å–∫–∞
3. ‚úÖ –†–∞–∑–Ω—ã–µ –ø—É—Ç–∏ –¥–ª—è Supabase –∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
4. ‚úÖ Media model accessor —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º –¥–∏—Å–∫–æ–º
5. ‚úÖ API endpoints –∑–∞—â–∏—â–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ permissions

### –ß—Ç–æ –ù—É–∂–Ω–æ –°–¥–µ–ª–∞—Ç—å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:

1. ‚úÖ –ü–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è: `http://localhost:3000/auth/force-logout`
2. ‚úÖ –í–æ–π—Ç–∏ —Å admin credentials
3. ‚úÖ –û—Ç–∫—Ä—ã—Ç—å `/dashboard/news`
4. ‚úÖ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
5. ‚úÖ –†–∞–¥–æ–≤–∞—Ç—å—Å—è! üéâ

---

## üöÄ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ú–µ–¥–∏–∞—Ñ–∞–π–ª–∞–º–∏

–û—Ç–∫—Ä–æ–π—Ç–µ `/dashboard/media` –¥–ª—è:

- üìÅ –ü—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- üîç –ü–æ–∏—Å–∫–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
- üè∑Ô∏è –§–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –¥–æ–∫—É–º–µ–Ω—Ç—ã)
- üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏—è –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è alt-text –∏ –æ–ø–∏—Å–∞–Ω–∏—è

### –¢–∏–ø—ã –§–∞–π–ª–æ–≤

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**

```
‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: JPG, JPEG, PNG, GIF, WebP, SVG
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç—ã: PDF, DOC, DOCX
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**

```
Max —Ä–∞–∑–º–µ—Ä: 5MB
Max —à–∏—Ä–∏–Ω–∞: –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
Max –≤—ã—Å–æ—Ç–∞: –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
```

---

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –î–µ—Ç–∞–ª–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ö–æ–¥–µ

**1. MediaService.php** (—Å—Ç—Ä–æ–∫–∏ 46-93)

```php
// –î–æ:
$fullPath = $file->storeAs($path, $filename, 'public');  ‚ùå
'disk' => 'public',  ‚ùå

// –ü–æ—Å–ª–µ:
$disk = config('filesystems.default');  ‚úÖ
$path = ($disk === 'supabase') ? date('Y/m/d') : 'media/' . date('Y/m/d');  ‚úÖ
$fullPath = $file->storeAs($path, $filename, $disk);  ‚úÖ
'disk' => $disk,  ‚úÖ
```

**2. AddMediaPermissionsSeeder.php** (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

```php
$newPermissions = [
    ['name' => 'media.view', ...],
    ['name' => 'media.upload', ...],
    ['name' => 'media.delete', ...],
];
```

**3. routes/api.php** (—É–∂–µ –±—ã–ª–æ)

```php
Route::middleware(['auth:sanctum', 'permission:media.view'])->group(function () {
    Route::get('/media', [MediaController::class, 'index']);  ‚úÖ
});

Route::middleware(['auth:sanctum', 'permission:media.upload'])->group(function () {
    Route::post('/media', [MediaController::class, 'store']);  ‚úÖ
});
```

---

_–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ: 2025-11-13_
_–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ! –ü–µ—Ä–µ–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –∏ –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è!_ üöÄüì∏
