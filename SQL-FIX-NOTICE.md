# ‚úÖ SQL –°–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω!

## –ü—Ä–æ–±–ª–µ–º–∞

–í—ã –ø–æ–ª—É—á–∏–ª–∏ –æ—à–∏–±–∫—É:

```
ERROR: 42883: operator does not exist: text = uuid
```

–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤ RLS policies.

## –†–µ—à–µ–Ω–∏–µ

–Ø –∏—Å–ø—Ä–∞–≤–∏–ª —Ñ–∞–π–ª `supabase-setup.sql`:

**–ë—ã–ª–æ:**

```sql
auth.uid()::text = owner
```

**–°—Ç–∞–ª–æ:**

```sql
auth.uid() = owner::uuid
```

---

## üìÅ –î–æ—Å—Ç—É–ø–Ω—ã–µ SQL —Å–∫—Ä–∏–ø—Ç—ã

### 1. supabase-setup-simple.sql (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)

**–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:**

- ‚úÖ Storage buckets (media, documents, avatars)
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ RLS policies (–¥–æ—Å—Ç—É–ø –¥–ª—è –≤—Å–µ—Ö –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö)
- ‚úÖ PostgreSQL —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –¥–ª—è timestamps

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- –ü—Ä–æ—Å—Ç—ã–µ policies –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
- –í—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å/–∏–∑–º–µ–Ω—è—Ç—å —Ñ–∞–π–ª—ã
- –ù–∏–∫–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- **–ó–∞–ø—É—Å—Ç–∏—Ç—Å—è –±–µ–∑ –ø—Ä–æ–±–ª–µ–º!**

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ –∏ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–ø–ª–æ—è

### 2. supabase-setup.sql (–ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è)

**–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:**

- ‚úÖ –í—Å–µ –∏–∑ simple –≤–µ—Ä—Å–∏–∏ +
- ‚úÖ –°—Ç—Ä–æ–≥–∏–µ RLS policies —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã policies –¥–ª—è —Ç–∞–±–ª–∏—Ü (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã)
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã)
- ‚úÖ Views –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—ã –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å/—É–¥–∞–ª—è—Ç—å —Å–≤–æ–∏ —Ñ–∞–π–ª—ã
- –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ auth
- –ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è production

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 1: –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://app.supabase.com)
2. SQL Editor ‚Üí New Query
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ **supabase-setup-simple.sql**
4. –ù–∞–∂–º–∏—Ç–µ **Run** –∏–ª–∏ **Ctrl+Enter**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
‚úì –°–æ–∑–¥–∞–Ω–æ 3 buckets
‚úì –°–æ–∑–¥–∞–Ω–æ 12 RLS policies
‚úì –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
‚úì –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è update_updated_at_column
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è (–¥–ª—è production)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **supabase-setup.sql** –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫:

- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
- ‚úÖ –ì–æ—Ç–æ–≤—ã –∫ —Å—Ç—Ä–æ–≥–∏–º –ø—Ä–∞–≤–∞–º –¥–æ—Å—Ç—É–ø–∞

---

## üîß –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ supabase-setup.sql

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ policies:

```sql
-- Media bucket
CREATE POLICY "Users can update own media files"
ON storage.objects FOR UPDATE
USING (
  bucket_id = 'media'
  AND auth.uid() = owner::uuid  -- ‚Üê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!
);

CREATE POLICY "Users can delete own media files"
ON storage.objects FOR DELETE
USING (
  bucket_id = 'media'
  AND auth.uid() = owner::uuid  -- ‚Üê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!
);

-- Documents bucket
CREATE POLICY "Authenticated users can read own documents"
ON storage.objects FOR SELECT
USING (
  bucket_id = 'documents'
  AND auth.uid() = owner::uuid  -- ‚Üê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!
);
```

### –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ—è—Å–Ω–µ–Ω–∏–µ –æ —Ç–∏–ø–∞—Ö:

```sql
-- –í–ê–ñ–ù–û: –û —Ç–∏–ø–∞—Ö –¥–∞–Ω–Ω—ã—Ö –≤ RLS policies
-- - auth.uid() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç UUID
-- - storage.objects.owner —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ TEXT, –Ω—É–∂–Ω–æ –ø—Ä–∏–≤–æ–¥–∏—Ç—å: owner::uuid
-- - –í —Ç–∞–±–ª–∏—Ü–∞—Ö user_id –æ–±—ã—á–Ω–æ UUID –∏–ª–∏ bigint (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—à–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏)
```

---

## ‚úÖ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π SQL —Å–∫—Ä–∏–ø—Ç:**

   ```
   supabase-setup-simple.sql
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ buckets:**
   - Storage ‚Üí Buckets
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å: media, documents, avatars

3. **–î–µ–ø–ª–æ–π—Ç–µ –Ω–∞ Railway:**

   ```bash
   git push
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**

   ```bash
   railway run php artisan migrate --force
   ```

5. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤**

6. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:** –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–≥–∏–µ policies –∏–∑ `supabase-setup.sql`

---

## üí° –°–æ–≤–µ—Ç

–ù–∞—á–Ω–∏—Ç–µ —Å **supabase-setup-simple.sql** –¥–ª—è:

- ‚úÖ –ë—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
- ‚úÖ –ò–∑–±–µ–∂–∞–Ω–∏—è –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ **supabase-setup.sql** –∫–æ–≥–¥–∞:

- ‚úÖ –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –ù—É–∂–Ω—ã —Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

---

–¢–µ–ø–µ—Ä—å SQL —Å–∫—Ä–∏–ø—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫! üéâ
